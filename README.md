# kubo-deployment

Kubo is a [BOSH](https://bosh.io/) release for Kubernetes. It provides a solution for deploying and managing Kubernetes with BOSH alongside [Cloud Foundry](https://cloudfoundry.org). 

This repository contains the documentation, automation, and manifests for deploying [kubo-release](https://github.com/pivotal-cf-experimental/kubo-release) with BOSH.

## Table of Contents

- [Design](#design)
- [Glossary](#glossary)
- [Installation Guides](#installation)
- [Trouleshooting](#troubleshooting)
- [Contribution](#contributing)

## Design

### Components

![Components of Kubo](docs/images/kubo-components.png)

Kubo depends on Cloud Foundry to perform routing to the Kubernetes cluster. The Kubo deployment is responsible for anouncing these routes to the Cloud Foundry Routing API. A specialized BOSH director manages the virtual machines for the Kubo instance which handles VM creation, health checking, and resurrection of missing or unhealthy VMs. The BOSH director includes CredHub to handle certificate generation and secrets storage for the deployment and PowerDNS.

Kubernetes applications deployed to a Kubo instance are not currently exposed to the outside world but may follow the same pattern of uitilizing the Cloud Foundry routing infrastructure in the future.

### Networking Topology

![Diagram describing how traffic is routed to Kubo](docs/images/kubo-network.png)

The nodes that run the Kubernetes API (kube-master) register themselves with the Cloud Foundry TCP router. The TCP Router acts as the public endpoint for the Kubernetes API to route traffic to the master nodes of a Kubo instance. All traffic to the API goes through the Cloud Foundry TCP router and then to a healthy kube-master node. 

The Cloud Foundry subnet must be able to route traffic directly to the Kubo subnet. It is recommended to keep them in seperate subnets when possible to avoid the BOSH directors from trying to provision the same addresses. This diagram specifies CIDR ranges for demonstration purposes as well as a public TCP router in front of Cloud Foundry which is typical.

## Glossary

- Kubo - Kubernetes on BOSH
- KuBOSH - BOSH with UAA, Credhub and PowerDNS
- [Bastion](https://en.wikipedia.org/wiki/Jump_server) - A server within the kubo network that provides secure access to kubo.
- BOSH Configuration - Folder that contains all configuration files needed to deploy KuBOSH, as well as all 
configuration files that are generated while deploying KuBOSH. Also called `<BOSH_ENV>`
- Environment Configuration and Environment Secrets - Configuration files that are used to deploy Kubo, these
are stored in `<BOSH_ENV>/director.yml` and `<BOSH_ENV>/director-secrets.yml`, respectively.
- Creds - Credentials that are generated by the KuBOSH deployment process and stored in `<BOSH_ENV>/creds.yml`
- Service - We will use the following terms to distinguish between different uses of the word "service"
  - [Service Instance](https://docs.cloudfoundry.org/devguide/services) - Cloud foundry services, which allow 
    provisioning of resources within a Cloud Foundry installation
  - [K8s service](https://kubernetes.io/docs/user-guide/services) - A logical collection of Kubernetes pods and
    a way to access them without needing information about the specific pods

## Installation

Please choose the guide below that matches your requirements

1. Deploy Kubo from scratch with an open source Cloud Foundry installation on Google Cloud Platform - [guide](docs/guides/gcp-oss-cf)
1. Deploy Kubo with a Pivotal Cloud Foundry installation using OpsMan - [guide](docs/guides/opsman-installation.md)
1. Deploy Kubo step by step, allowing for customization - [guide](docs/guides/customized-installation.md)

## Troubleshooting

Please refer to the [troubleshooting guide](docs/troubleshooting.md) to look for solutions to the most common issues. 

## Contributing

For instructions on contributing to this project, please see [CONTRIBUTING.md](CONTRIBUTING.md).
